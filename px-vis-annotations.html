<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="px-vis-behavior-common.html" />
<link rel="import" href="px-vis-behavior-d3.html" />
<link rel="import" href="../px-icon-set/px-icon.html" />
<link rel="import" href="../px-icon-set/px-icon-set-communication.html" />
<link rel="import" href="css/px-vis-annotations-styles.html">

<!--

### Usage

    <px-vis-svg
        ...
        svg="{{svg}}">
    </px-vis-svg>
    <px-vis-scale
        ...
        x="{{x}}"
        y="{{y}}"
        domain-changed="{{domainChanged}}">
    </px-vis-scale>

    <px-vis-annotations
        svg="[[svg]]"
        x="[[x]]"
        y="[[y]]"
        domain-changed="[[domainChanged]]"
        complete-series-config="[[completeSeriesConfig]]"
        annotation-data="[[data]]">
    </px-vis-annotations>

### Styling
The following custom properties are available for styling:

Custom property | Description
:----------------|:-------------



@element px-vis-annotations
@blurb Element which draws annotations on a chart
@homepage index.html
@demo demo/index.html

-->

<dom-module id="px-vis-annotations">
    <template>
      <style include="px-vis-annotations-styles"></style>

      <template id="template" is="dom-repeat" items="[[annotationData]]" as="item">
        <px-icon
          icon="px-com:comment"
          data="[[item]]"
          class="annotation--icon"
          style$="[[_getTransform(item, x, y, domainChanged, completeSeriesConfig)]]"
          on-mouseover="_mouseOver"
          on-mouseleave="_mouseLeave"
          on-click="_mouseClick"
          on-mouseenter="_mouseEnter"
          on-mouseout="_mouseOut">
        </px-icon>
      </template>
    </template>
</dom-module>

<script>
  Polymer({

    is: 'px-vis-annotations',

    behaviors: [
      PxVisBehavior.sizing,
      PxVisBehaviorD3.svg,
      PxVisBehavior.annotationData
    ],

    /**
     * Properties block, expose attribute values to the DOM via 'reflect'
     *
     * @property properties
     * @type Object
     */
    properties: {
      _iconWidth: {
        type: Number,
        value: 12
      },
      _iconHeight: {
        type: Number,
        value: 12
      },
      /**
       * Whether the scatter plot is using radial coordinates (x=phase, y=amplitude).
       */
      radial: {
        type: Boolean,
        value: false
      }

    }, //properties

    observers: [

    ],

    _getTransform: function(item) {

      var result = '';

      //ask the chart scale to convert those data values to pixels
      this.fire('px-vis-request-pixel-for-data', {callback: function(pix) {

          pix[0] -= this._iconWidth/2;
          pix[1] -= this._iconHeight;

          result = 'transform: translate(' + pix[0] + 'px,' + pix[1] + 'px)';
        }.bind(this), data: [item.x, item.y], series: item.series, margin: this.margin}
      );

      return result;
    },

    _mouseOver: function(evt) {
      this._requestAnnotation(evt, 'over');
    },

    _mouseLeave: function(evt) {
      this._requestAnnotation(evt, 'leave');
    },

    _mouseClick: function(evt) {
      this._requestAnnotation(evt, 'click');
    },

    _mouseEnter: function(evt) {
      this._requestAnnotation(evt, 'enter');
    },

    _mouseOut: function(evt) {
      this._requestAnnotation(evt, 'out');
    },

    _requestAnnotation(evt, eventName) {
      var target = Polymer.dom(evt).localTarget;

      this.fire('px-vis-event-request', {'eventName': 'px-vis-annotation-' + eventName, 'data': {'annotationData': this.$.template.itemForElement(target), 'icon': target}});
    }
  });
</script>
